\documentclass[10pt,a4paper]{article}

% ==============================
% Layout / Page Geometry
% ==============================
\usepackage[margin=1.5cm]{geometry}
\pagestyle{empty}

% ==============================
% Fonts (XeLaTeX)
% ==============================
\usepackage{fontspec}
\setmainfont{TeX Gyre Heros}

% ==============================
% Basic Packages
% ==============================
\usepackage[hidelinks]{hyperref} % clickable links, no colored boxes
\usepackage{xcolor}             % colors
\usepackage{titlesec}           % heading formatting
\usepackage{tabularx}           % flexible tables
\usepackage{enumitem}           % list spacing control
\usepackage{setspace}           % line spacing control
\usepackage{calc}               % for calculations



% ==============================
% Colors
% ==============================
\definecolor{cvline}{HTML}{BBBBBB} % light grey line color
\definecolor{cvtext}{HTML}{333333} % main text color

% ==============================
% Paragraph formatting
% ==============================
\setlength{\parindent}{0pt} % no paragraph indentation
\setlength{\parskip}{0.0em}
\setstretch{1.1}              % single line spacing

% ==============================
% List styles
% ==============================

% Pandoc tightlist removal â€“ allows \setlist settings to take effect
\let\tightlist\relax

% Adjust spacing for itemize lists to look compact on a CV.
\setlist[itemize]{
  topsep=0.2em,
  itemsep=0.1em,
  parsep=0em,
  partopsep=0em,
  leftmargin=1.2em,
}


% ==============================
% Heading Styles
% Pandoc mapping (default):
%   #    -> \section
%   ##   -> \subsection
%   ###  -> \subsubsection
% ==============================

% --- H1 (#) ---
% Used for main CV sections like professional experience, education, skills etc.
% We add a horizontal line above the heading.
\titleformat{\section}{\large\bfseries\color{cvtext}}{}{0pt}
  {%
    \color{cvline}\rule{\linewidth}{0.4pt}\vspace{0.3em}\newline\color{cvtext}%
  }
\titlespacing*{\section}{0pt}{-0.3em}{0.3em}

% --- H2 (##) ---
% Used for company / university names etc.
\titleformat{\subsection}{\normalsize\bfseries\color{cvtext}}{}{0pt}{}
\titlespacing*{\subsection}{0pt}{0.5em}{0.0em}

% --- H3 (###) ---
% Used for job title / degree title.
% We want no extra spacing after it so it sticks to the next line.
\titleformat{\subsubsection}{\normalsize\bfseries\color{cvtext}}{}{0pt}{}
\titlespacing*{\subsubsection}{0pt}{0.0em}{0.2em}

% --- Optional: H4 (####) ---
% Pandoc usually does not map #### to a LaTeX heading by default,
% but if it does (or via custom filters), it often maps to \paragraph.
\titleformat{\paragraph}{\normalsize\bfseries\color{cvtext}}{}{0pt}{}
\titlespacing*{\paragraph}{0pt}{0em}{0em}

% ==============================
% Custom Macro: Heading + Metadata on one line
% ==============================
% This macro is typically inserted by a Lua filter:
% \HeadingWithNote{Heading Text}{Metadata}
%
% It prints:
%   Heading Text (bold)  |  Metadata (italic, right-aligned)
%
% Example Use Case:
%   - For an H2 or H3 heading with additional metadata (e.g., dates, descriptions, etc.)
%   - Example: \HeadingWithNote{Company Name}{Apr 2022 - Jul 2024}
%     Output: "Company Name" (bold, left-aligned) and "Apr 2022 - Jul 2024" (italic, right-aligned)
%
% Arguments:
%   #1: The main heading text (e.g., "Company Name" or "Project Title")
%   #2: The metadata (e.g., "Apr 2022 - Jul 2024" or "Description")
\newcommand{\HeadingWithNote}[3]{
  % #1 = Level (1, 2, 3)
  % #2 = Heading text (e.g., company name, project title)
  % #3 = Note text (e.g., dates, description)
  \ifnum#1=1
    \section*{#2 \hfill \normalsize \textit{#3}}
  \else\ifnum#1=2
    \subsection*{#2 \hfill \normalfont \normalsize \textit{#3}}
  \else\ifnum#1=3
    \subsubsection*{#2 \hfill \normalfont \normalsize \textit{#3}}
  \fi\fi\fi
}



% ==============================
% Custom Macro: Dynamic Contact Info with Separators
% ==============================

% Separator definition
\newcommand{\sep}{~\textbullet~}

% Setup for measuring text width
\newlength{\currentlinewidth}
\setlength{\currentlinewidth}{0pt}

\newlength{\separatorwidth}
\setlength{\separatorwidth}{\widthof{\sep}}

\newlength{\itemwidth}

% Setup counter for number of contact items added
\newcounter{contactcount}

% Macro to add a contact item with dynamic line breaking
\newcommand{\contactitem}[2]{%
  \setlength{\itemwidth}{\widthof{#1}}%
  % Check if adding this item would exceed line width
  \ifdim \dimexpr \currentlinewidth + \itemwidth + \separatorwidth > \linewidth
    \\
    \href{#2}{#1}%
    \setlength{\currentlinewidth}{\widthof{#1}}%
  % Else, add separator if not the first item
  \else
    \ifnum\value{contactcount}>0
      \sep
    \fi
    \href{#2}{#1}%
    \addtolength{\currentlinewidth}{\itemwidth}%
  \fi
  \stepcounter{contactcount}%
}

% Macro to reset line width and contact count (to be called at start)
\newcommand{\startcontactlist}{%
  \setlength{\currentlinewidth}{0pt}%
  \setcounter{contactcount}{0}%
}


% ==============================
% Document
% ==============================
\begin{document}
\color{cvtext}

% ==============================
% Header block (name + contact)
% Values are injected by Pandoc from YAML front matter.
% Example in Markdown:
%
% ---
% name: Joe Bloggs
% email: joe.bloggs@...
% phone: ...
% linkedin: linkedin.com/in/...
% github: github.com/...
% address: ...
% ---
% ==============================
{\Huge \textbf{$name$}}\vspace{0.2em}

\startcontactlist
\ifx\empty$email$\else\contactitem{$email$}{mailto:$email$}\fi%
\ifx\empty$phone$\else\contactitem{$phone$}{tel:$phone$}\fi%
\ifx\empty$linkedin$\else\contactitem{$linkedin$}{$linkedin$}\fi%
\ifx\empty$github$\else\contactitem{$github$}{$github$}\fi%
\ifx\empty$address$\else\contactitem{$address$}{$address$}\fi%



% ==============================
% Main body rendered from Markdown
% ==============================
$body$

\end{document}
